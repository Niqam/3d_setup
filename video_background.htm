<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immersive Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 1. LOAD PANO2VR LIBRARIES HERE (In the Head) -->
    <!-- These files must be in the same folder as index.html -->
    <script type="text/javascript" src="pano2vr_player.js?ts=45848673"></script>
    <script type="text/javascript" src="skin.js?ts=45848673"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }

        /* Video Layer */
        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 50;
            transition: opacity 1s ease-out;
            background-color: black;
        }

        #intro-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Tour Layer */
        #tour-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }
        
        .fade-out { opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

    <!-- LAYER 1: Intro Video -->
    <div id="intro-overlay">
        <video id="intro-video" autoplay muted playsinline>
            <!-- NOTE: Changed source to a web URL for preview. Change this back to your local file path. -->
            <!-- Your Path: C:\Users\PC\Downloads\3DVista-3D-Fly-Over-Mode-Demo.mp4 -->
            <source src="C:\Users\PC\Downloads\3DVista-3D-Fly-Over-Mode-Demo.mp4" type="video/mp4">
        </video>
    </div>

    <!-- LAYER 2: Tour Container -->
    <div id="tour-container">
        <!-- 2. PLACE THE PANO DIV HERE (In the Body) -->
        <div id="container" style="width:100%;height:100%;overflow:hidden;">
            <br>Loading Virtual Tour...<br><br>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        const video = document.getElementById('intro-video');
        const introOverlay = document.getElementById('intro-overlay');

        // Listen for video end
        video.addEventListener('ended', () => {
            console.log("Video finished. Initializing Tour...");
            introOverlay.classList.add('fade-out');
            initVirtualTour();
            setTimeout(() => {
                introOverlay.style.display = 'none';
                video.remove(); 
            }, 1000); 
        });

        // 3. PURE JAVASCRIPT LOGIC HERE
        function initVirtualTour() {
            
            // Helper function from your code
            function parseParams(paramsString, params) {
                paramsString = paramsString.substring(1);
                var firstSeparatorPos = paramsString.indexOf(",");
                if (firstSeparatorPos != -1) {
                    params.startNode = paramsString.slice(0, firstSeparatorPos);
                    var viewingParamsString = paramsString.slice(firstSeparatorPos + 1);
                    var viewingParams = viewingParamsString.split(",");
                    if (viewingParams.length >= 3) {
                        var startView = {};
                        startView["pan"] = viewingParams[0];
                        startView["tilt"] = viewingParams[1];
                        startView["fov"] = viewingParams[2];
                        if (viewingParams.length >= 4) {
                            startView["projection"] = viewingParams[3];
                        }
                        params.startView = startView;
                    }
                } else {
                    params.startNode = paramsString;
                    params.startView = "";
                }
            }

            // Initialize Params
            var params = {};
            parseParams(document.location.hash, params);
            var startNode = params.startNode;
            var startView = params.startView;

            // Hash Change Listener
            if (("onhashchange" in window) && (!(/MSIE (\d+\.\d+);/.test(navigator.userAgent)))) {
                window.onhashchange = function () {
                    parseParams(window.location.hash, params);
                    pano.openNext('{' + params.startNode + '}', params.startView);
                }
            } else {
                var lastHash = window.location.hash;
                window.setInterval(function () {
                    if (window.location.hash != lastHash) {
                        lastHash = window.location.hash;
                        parseParams(window.location.hash, params);
                        pano.openNext('{' + params.startNode + '}', params.startView);
                    }
                }, 100);
            }

            // --- CREATE PLAYER ---
            // Ensure 'container' matches the ID of the div in the HTML body above
            var pano = new pano2vrPlayer("container"); 
            pano.startNode = startNode;
            pano.startView = startView;
            pano.setQueryParameter("ts=45848673");
            
            // --- ADD SKIN ---
            var skin = new pano2vrSkin(pano);
            
            // --- CONFIGURATION XML ---
            var panorama='<?xml version="1.0" encoding="UTF-8"?>';
            panorama+='<tour apprev="20986" start="node6" hassounds="1" appversion="7.1.8">';
            panorama+='  <panorama id="node6">';
            panorama+='    <input levelingroll="0" height="79" levelbiashidpi="1.000" overlap="1" levelbias="0.400" leveltileurl="tiles/node6/cf_%c/l_%l/c_%x/tile_%y.jpg" levelingpitch="0" leveltilesize="510" width="79">';
            panorama+='      <level height="79" predecode="1" preload="1" width="79"/>';
            panorama+='      <preview color="0x808080" strip="1"/>';
            panorama+='    </input>';
            panorama+='    <view pannorth="0" fovmode="2">';
            panorama+='      <start projection="4" fov="100" pan="-3.86" tilt="-3.29"/>';
            panorama+='      <flyin projection="9" fov="170" pan="0" tilt="-90"/>';
            panorama+='      <min pan="0" tilt="-90" fovpixel="2"/>';
            panorama+='      <max scaletofit="1" fovstereographic="330" fov="140" pan="360" tilt="90" fovfisheye="360"/>';
            panorama+='    </view>';
            panorama+='    <userdata nodeid="node6" copyright="" heading="0" author="" customnodeid="" datetime="" description="" tags="Pano2VR7" longitude="" title="sitting room" comment="" source="" latitude="" info=""/>';
            panorama+='    <hotspots height="20" wordwrap="1" width="180" smoothmovement="0">';
            panorama+='      <label background="1" height="20" enabled="1" bordercolor="0x000000" wordwrap="1" borderradius="1" border="1" textalpha="1" backgroundalpha="1" width="180" backgroundcolor="0xffffff" borderalpha="1" textcolor="0x000000"/>';
            panorama+='      <polystyle bordercolor="0x0000ff" handcursor="1" mode="0" backgroundalpha="0.25098" backgroundcolor="0x0000ff" borderalpha="1"/>';
            panorama+='      <hotspot title="dining room 1" pan="-154.59" id="Point01" tilt="15.82" skinid="ht_node" description="" url="{node7}" target="34.0/-6.4/110.5"/>';
            panorama+='    </hotspots>';
            panorama+='    <media>';
            panorama+='      <video popbackmode="0" height="100" fov="109.390" stretch="0.713" tilt="21.700" clickmode="2" rotx="25.820" nodechangekeep="0" rotz="3.900" popoutscaling="100" hidepinned="0" pansize="10.000" width="100" field="90.000" loop="1" level="1.000" mode="1" tiltsize="10.000" handcursor="0" ambientlevel="0.000" pan="-22.460" id="Element01" startmutedmobile="0" roty="-13.280">';
            panorama+='        <source url="media/3DVista-3D-Fly-Over-Mode-Demo-1.mp4"/>';
            panorama+='      </video>';
            panorama+='      <sound loop="-1" level="0.500" tilt="-1.000" mode="0" tiltsize="10.000" nodechangekeep="1" ambientlevel="0.000" pan="-1.000" id="_background" startmutedmobile="0" pansize="10.000" field="90.000">';
            panorama+='        <source mono="0" url="media/Kun Anta _ Vocals Only - Without Music _ Slow  Reverb - English Lyrics  Translation _ Hamood.mp3"/>';
            panorama+='      </sound>';
            panorama+='    </media>';
            panorama+='    <transition enabled="1" zoomout="3" zoomspeed="2" zoomin="2" delay="none" zoomafteroutfov="40" type="diptocolor" zoomafterinfov="140" zoomoutpause="1" blendcolor="0xaaff00" zoomfov="40" blendtime="1" softedge="0"/>';
            panorama+='    <animation clipsrandom="0" useinautorotation="1" animsequence="Animation01" syncanimationwithvideo="1">';
            panorama+='      <clip nodeid="" cliptitle="Clip01" nextclipstartview="35.72/-3.6/100/4" nextclipnodeid="node7" animtype="0" nextcliptitle="Clip01" animtitle="Animation01" transitiontype="0" length="94">';
            panorama+='        <keyframe time="0" type="0" transitiontime="0" property="0" value="-3.86" valuestring="" additionaltrackid=""/>';
            panorama+='        <keyframe time="0" type="0" transitiontime="0" property="1" value="-3.29" valuestring="" additionaltrackid=""/>';
            panorama+='        <keyframe time="0" type="0" transitiontime="0" property="2" value="100" valuestring="" additionaltrackid=""/>';
            panorama+='        <keyframe time="0" type="0" transitiontime="0" property="3" value="4" valuestring="" additionaltrackid=""/>';
            panorama+='        <keyframe time="94" bezieroutvalue="-166.134" property="0" bezierouttime="10094" type="2" transitiontime="0" bezierinvalue="-166.134" bezierintime="45.4" value="-166.134" valuestring="" additionaltrackid=""/>';
            panorama+='        <keyframe time="94" bezieroutvalue="1.65362" property="1" bezierouttime="10094" type="2" transitiontime="0" bezierinvalue="1.65362" bezierintime="45.4" value="1.65362" valuestring="" additionaltrackid=""/>';
            panorama+='        <keyframe time="94" bezieroutvalue="100" property="2" bezierouttime="10094" type="2" transitiontime="0" bezierinvalue="100" bezierintime="45.4" value="100" valuestring="" additionaltrackid=""/>';
            panorama+='      </clip>';
            panorama+='    </animation>';
            panorama+='    <control speedwheel="1" contextprojections="0" rubberband="0" lockedkeyboard="0" dblclickfullscreen="1" invertcontrol="1" sensitivity="8" hideabout="0" simulatemass="1" lockedkeyboardzoom="0" invertwheel="0" lockedwheel="0" lockedmouse="0" contextfullscreen="1" zoomcentercursor="1" contextvr="1"/>';
            panorama+='  </panorama>';
            
            // NOTE: I have truncated the massive XML string for brevity in this display, 
            // but you should keep the FULL XML string you had in your original code here.
            // The important part is that "pano.readConfigString(panorama)" is called at the end.
            
            // ... (Include the rest of your panorama+= lines for node7, node8, etc here) ...

            panorama+='</tour>';
            
            // EXECUTE
            pano.readConfigString(panorama);
        }
    </script>
</body>
</html>