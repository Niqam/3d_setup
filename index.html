<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immersive Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 1. LOAD PANO2VR LIBRARIES HERE (In the Head) -->
    <!-- These files must be in the same folder as index.html -->
    <script type="text/javascript" src="pano2vr_player.js?ts=45848673"></script>
    <script type="text/javascript" src="skin.js?ts=45848673"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: sans-serif; }

        /* Video Layer - Covers the screen initially */
        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 50; /* High z-index ensures it sits ON TOP of the tour */
            transition: opacity 1s ease-out;
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #intro-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        /* Start Button Overlay */
        #start-screen {
            position: relative;
            z-index: 10; /* Above video */
            text-align: center;
            color: white;
        }

        .glass-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border-radius: 50px;
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        /* Tour Layer - Sits behind video until video fades out */
        #tour-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }
        
        .fade-out { opacity: 0; pointer-events: none; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- LAYER 1: Intro Video & Start Button -->
    <div id="intro-overlay">
        
        <!-- The Start Button (Required for Audio) -->
        <div id="start-screen">
            <h1 class="text-4xl mb-8 tracking-widest font-light">IMMERSIVE TOUR</h1>
            <button id="start-btn" class="glass-btn">Enter Experience</button>
        </div>

        <!-- Video: Removed 'autoplay' and 'muted' to allow sound -->
        <video id="intro-video" playsinline>
            <!-- IMPORTANT: REPLACE THIS SRC WITH YOUR LOCAL VIDEO PATH -->
            <!-- Example: src="3DVista-3D-Fly-Over-Mode-Demo.mp4" -->
            <source src="C:\Users\PC\Documents\panorama images\output\media\3DVista-3D-Fly-Over-Mode-Demo-1.mp4" type="video/mp4">
        </video>
    </div>

    <!-- LAYER 2: Tour Container -->
    <div id="tour-container">
        <!-- The Tour attaches to this div -->
        <div id="container" style="width:100%;height:100%;overflow:hidden;">
            <!-- This text is hidden by the video overlay -->
            <br>Loading Virtual Tour...<br><br>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        const video = document.getElementById('intro-video');
        const introOverlay = document.getElementById('intro-overlay');
        const startBtn = document.getElementById('start-btn');
        const startScreen = document.getElementById('start-screen');
        
        // Flag to prevent double loading
        let tourStarted = false;

        // 1. START BUTTON CLICK
        startBtn.addEventListener('click', () => {
            // Hide the button text
            startScreen.classList.add('fade-out');
            
            // Play video with sound
            video.play().then(() => {
                console.log("Video playing with audio.");
            }).catch((error) => {
                console.error("Video play failed:", error);
            });
        });

        // 2. THE CRITICAL TRIGGER: Wait for video to end
        video.addEventListener('ended', () => {
            if (tourStarted) return;
            tourStarted = true;

            console.log("Video finished. Activating Tour now...");
            
            // Fade out the black overlay
            introOverlay.classList.add('fade-out');

            // START THE TOUR CODE
            initVirtualTour();

            // Cleanup video element to save memory
            setTimeout(() => {
                introOverlay.style.display = 'none';
                video.remove(); 
            }, 1000); 
        });

        // 3. THE TOUR LOGIC WRAPPER
        // This function sits dormant and DOES NOT RUN until called above.
        function initVirtualTour() {
            
            // Clear the "Loading..." text
            document.getElementById('container').innerHTML = "";

            // --- YOUR PROVIDED PANO2VR CODE STARTS HERE ---

            // Helper function to parse URL parameters
            function parseParams(paramsString, params) {
                paramsString = paramsString.substring(1);
                var firstSeparatorPos = paramsString.indexOf(",");
                if (firstSeparatorPos != -1) {
                    params.startNode = paramsString.slice(0, firstSeparatorPos);
                    var viewingParamsString = paramsString.slice(firstSeparatorPos + 1);
                    var viewingParams = viewingParamsString.split(",");
                    if (viewingParams.length >= 3) {
                        var startView = {};
                        startView["pan"] = viewingParams[0];
                        startView["tilt"] = viewingParams[1];
                        startView["fov"] = viewingParams[2];
                        if (viewingParams.length >= 4) {
                            startView["projection"] = viewingParams[3];
                        }
                        params.startView = startView;
                    }
                } else {
                    params.startNode = paramsString;
                    params.startView = "";
                }
            }

            // Initialize Params
            var params = {};
            parseParams(document.location.hash, params);
            var startNode = params.startNode;
            var startView = params.startView;

            // Hash Change Listener logic
            if (("onhashchange" in window) && (!(/MSIE (\d+\.\d+);/.test(navigator.userAgent)))) {
                window.onhashchange = function () {
                    parseParams(window.location.hash, params);
                    if(window.pano) pano.openNext('{' + params.startNode + '}', params.startView);
                }
            } else {
                var lastHash = window.location.hash;
                window.setInterval(function () {
                    if (window.location.hash != lastHash) {
                        lastHash = window.location.hash;
                        parseParams(window.location.hash, params);
                        if(window.pano) pano.openNext('{' + params.startNode + '}', params.startView);
                    }
                }, 100);
            }

            // Create the Player
            // We attach it to 'container' div
            window.pano = new pano2vrPlayer("container");
            pano.startNode = startNode;
            pano.startView = startView;
            pano.setQueryParameter("ts=45848673");
            
            // Add Skin
            window.skin = new pano2vrSkin(pano);
            
            // --- LOAD XML CONFIGURATION ---
            var panorama='<?xml version="1.0" encoding="UTF-8"?>';
            panorama+='<tour apprev="20986" start="node6" hassounds="1" appversion="7.1.8">';
            
            // Node 6: Sitting Room
            panorama+='  <panorama id="node6">';
            panorama+='    <input levelingroll="0" height="79" levelbiashidpi="1.000" overlap="1" levelbias="0.400" leveltileurl="tiles/node6/cf_%c/l_%l/c_%x/tile_%y.jpg" levelingpitch="0" leveltilesize="510" width="79">';
            panorama+='      <level height="79" predecode="1" preload="1" width="79"/>';
            panorama+='      <preview color="0x808080" strip="1"/>';
            panorama+='    </input>';
            panorama+='    <view pannorth="0" fovmode="2">';
            panorama+='      <start projection="4" fov="100" pan="-3.86" tilt="-3.29"/>';
            panorama+='      <flyin projection="9" fov="170" pan="0" tilt="-90"/>';
            panorama+='      <min pan="0" tilt="-90" fovpixel="2"/>';
            panorama+='      <max scaletofit="1" fovstereographic="330" fov="140" pan="360" tilt="90" fovfisheye="360"/>';
            panorama+='    </view>';
            panorama+='    <userdata nodeid="node6" title="sitting room" tags="Pano2VR7"/>';
            panorama+='    <hotspots height="20" wordwrap="1" width="180" smoothmovement="0">';
            panorama+='      <label background="1" height="20" enabled="1" bordercolor="0x000000" wordwrap="1" borderradius="1" border="1" textalpha="1" backgroundalpha="1" width="180" backgroundcolor="0xffffff" borderalpha="1" textcolor="0x000000"/>';
            panorama+='      <polystyle bordercolor="0x0000ff" handcursor="1" mode="0" backgroundalpha="0.25098" backgroundcolor="0x0000ff" borderalpha="1"/>';
            panorama+='      <hotspot title="dining room 1" pan="-154.59" id="Point01" tilt="15.82" skinid="ht_node" url="{node7}" target="34.0/-6.4/110.5"/>';
            panorama+='    </hotspots>';
            panorama+='    <media>';
            panorama+='      <video popbackmode="0" height="100" fov="109.390" stretch="0.713" tilt="21.700" clickmode="2" rotx="25.820" nodechangekeep="0" rotz="3.900" popoutscaling="100" hidepinned="0" pansize="10.000" width="100" field="90.000" loop="1" level="1.000" mode="1" tiltsize="10.000" handcursor="0" ambientlevel="0.000" pan="-22.460" id="Element01" startmutedmobile="0" roty="-13.280">';
            panorama+='        <source url="media/3DVista-3D-Fly-Over-Mode-Demo-1.mp4"/>';
            panorama+='      </video>';
            panorama+='      <sound loop="-1" level="0.500" tilt="-1.000" mode="0" tiltsize="10.000" nodechangekeep="1" ambientlevel="0.000" pan="-1.000" id="_background" startmutedmobile="0" pansize="10.000" field="90.000">';
            panorama+='        <source mono="0" url="media/Kun Anta _ Vocals Only - Without Music _ Slow  Reverb - English Lyrics  Translation _ Hamood.mp3"/>';
            panorama+='      </sound>';
            panorama+='    </media>';
            panorama+='    <transition enabled="1" zoomout="3" zoomspeed="2" zoomin="2" delay="none" zoomafteroutfov="40" type="diptocolor" zoomafterinfov="140" zoomoutpause="1" blendcolor="0xaaff00" zoomfov="40" blendtime="1" softedge="0"/>';
            panorama+='    <control speedwheel="1" contextprojections="0" rubberband="0" lockedkeyboard="0" dblclickfullscreen="1" invertcontrol="1" sensitivity="8" hideabout="0" simulatemass="1" lockedkeyboardzoom="0" invertwheel="0" lockedwheel="0" lockedmouse="0" contextfullscreen="1" zoomcentercursor="1" contextvr="1"/>';
            panorama+='  </panorama>';

            // Node 7: Dining Room 1
            panorama+='  <panorama id="node7">';
            panorama+='    <input levelingroll="0" height="195" levelbiashidpi="1.000" overlap="1" levelbias="0.400" leveltileurl="tiles/node7/cf_%c/l_%l/c_%x/tile_%y.jpg" levelingpitch="0" leveltilesize="510" width="195">';
            panorama+='      <level height="195" predecode="1" preload="1" width="195"/>';
            panorama+='      <preview color="0x808080" strip="1"/>';
            panorama+='    </input>';
            panorama+='    <view pannorth="0" fovmode="2">';
            panorama+='      <start projection="4" fov="100" pan="35.72" tilt="-3.6"/>';
            panorama+='      <flyin projection="9" fov="170" pan="0" tilt="-90"/>';
            panorama+='      <min pan="-180" tilt="-57.4852" fovpixel="2"/>';
            panorama+='      <max fovstereographic="330" fov="140" pan="180" tilt="57.4852" fovfisheye="360"/>';
            panorama+='    </view>';
            panorama+='    <userdata nodeid="node7" title="dining room 1" tags="Pano2VR7"/>';
            panorama+='    <hotspots height="20" wordwrap="1" width="180" smoothmovement="0">';
            panorama+='      <label background="1" height="20" enabled="1" bordercolor="0x000000" wordwrap="1" borderradius="1" border="1" textalpha="1" backgroundalpha="1" width="180" backgroundcolor="0xffffff" borderalpha="1" textcolor="0x000000"/>';
            panorama+='      <polystyle bordercolor="0x0000ff" handcursor="1" mode="0" backgroundalpha="0.25098" backgroundcolor="0x0000ff" borderalpha="1"/>';
            panorama+='      <hotspot title="Dining room 2" pan="-325.31" id="Point01" tilt="-5.44" skinid="ht_node" url="{node8}" target="-167.6/18.8/110.5"/>';
            panorama+='    </hotspots>';
            panorama+='    <transition enabled="1" zoomout="3" zoomspeed="2" zoomin="2" delay="none" zoomafteroutfov="40" type="diptocolor" zoomafterinfov="140" zoomoutpause="1" blendcolor="0xaaff00" zoomfov="40" blendtime="1" softedge="0"/>';
            panorama+='  </panorama>';

            // Node 8: Dining Room 2
            panorama+='  <panorama id="node8">';
            panorama+='    <input levelingroll="0" height="195" levelbiashidpi="1.000" overlap="1" levelbias="0.400" leveltileurl="tiles/node8/cf_%c/l_%l/c_%x/tile_%y.jpg" levelingpitch="0" leveltilesize="510" width="195">';
            panorama+='      <level height="195" predecode="1" preload="1" width="195"/>';
            panorama+='      <preview color="0x808080" strip="1"/>';
            panorama+='    </input>';
            panorama+='    <view pannorth="0" fovmode="2">';
            panorama+='      <start projection="4" fov="100" pan="44.35" tilt="-2.22"/>';
            panorama+='      <flyin projection="9" fov="170" pan="0" tilt="-90"/>';
            panorama+='      <min pan="-180" tilt="-57.4852" fovpixel="2"/>';
            panorama+='      <max fovstereographic="330" fov="140" pan="180" tilt="57.4852" fovfisheye="360"/>';
            panorama+='    </view>';
            panorama+='    <userdata nodeid="node8" title="Dining room 2" tags="Pano2VR7"/>';
            panorama+='    <hotspots height="20" wordwrap="1" width="180" smoothmovement="0">';
            panorama+='      <label background="1" height="20" enabled="1" bordercolor="0x000000" wordwrap="1" borderradius="1" border="1" textalpha="1" backgroundalpha="1" width="180" backgroundcolor="0xffffff" borderalpha="1" textcolor="0x000000"/>';
            panorama+='      <polystyle bordercolor="0x0000ff" handcursor="1" mode="0" backgroundalpha="0.25098" backgroundcolor="0x0000ff" borderalpha="1"/>';
            panorama+='      <hotspot title="bedroom 1" pan="-177.33" id="Point01" tilt="38.47" skinid="ht_node" url="{node1}" target="-59.9/-1.8/149.4"/>';
            panorama+='    </hotspots>';
            panorama+='    <transition enabled="1" zoomout="3" zoomspeed="2" zoomin="2" delay="none" zoomafteroutfov="40" type="diptocolor" zoomafterinfov="140" zoomoutpause="1" blendcolor="0xaaff00" zoomfov="40" blendtime="1" softedge="0"/>';
            panorama+='  </panorama>';

            // Node 1: Bedroom 1
            panorama+='  <panorama id="node1">';
            panorama+='    <input levelingroll="0.401258" height="184" levelbiashidpi="1.000" overlap="1" levelbias="0.400" leveltileurl="tiles/node1/cf_%c/l_%l/c_%x/tile_%y.jpg" levelingpitch="-0.148178" leveltilesize="510" width="184">';
            panorama+='      <level height="184" predecode="1" preload="1" width="184"/>';
            panorama+='      <preview color="0x808080" strip="1"/>';
            panorama+='    </input>';
            panorama+='    <view pannorth="0" fovmode="2">';
            panorama+='      <start projection="4" fov="100" pan="158.84" tilt="0.94"/>';
            panorama+='      <flyin projection="9" fov="170" pan="0" tilt="-90"/>';
            panorama+='      <min pan="0" tilt="-90" fovpixel="2"/>';
            panorama+='      <max scaletofit="1" fovstereographic="330" fov="140" pan="360" tilt="90" fovfisheye="360"/>';
            panorama+='    </view>';
            panorama+='    <userdata nodeid="node1" title="bedroom 1" tags="Desktop"/>';
            panorama+='    <hotspots height="20" wordwrap="1" width="180" smoothmovement="0">';
            panorama+='      <label background="1" height="20" enabled="1" bordercolor="0x000000" wordwrap="1" borderradius="1" border="1" textalpha="1" backgroundalpha="1" width="180" backgroundcolor="0xffffff" borderalpha="1" textcolor="0x000000"/>';
            panorama+='      <polystyle bordercolor="0x0000ff" handcursor="1" mode="0" backgroundalpha="0.25098" backgroundcolor="0x0000ff" borderalpha="1"/>';
            panorama+='      <hotspot title="bedroom 2" pan="-62.42" id="Point02" tilt="-5.14" skinid="ht_node" url="{node2}" target="-143.2/-3.4/117.4"/>';
            panorama+='    </hotspots>';
            panorama+='    <transition enabled="1" zoomout="3" zoomspeed="2" zoomin="2" delay="none" zoomafteroutfov="40" type="diptocolor" zoomafterinfov="140" zoomoutpause="1" blendcolor="0xaaff00" zoomfov="40" blendtime="1" softedge="0"/>';
            panorama+='  </panorama>';

            // Node 2: Bedroom 2
            panorama+='  <panorama id="node2">';
            panorama+='    <input levelingroll="1.412330" height="184" levelbiashidpi="1.000" overlap="1" levelbias="0.400" leveltileurl="tiles/node2/cf_%c/l_%l/c_%x/tile_%y.jpg" levelingpitch="-2.825640" leveltilesize="510" width="184">';
            panorama+='      <level height="184" predecode="1" preload="1" width="184"/>';
            panorama+='      <preview color="0x808080" strip="1"/>';
            panorama+='    </input>';
            panorama+='    <view pannorth="0" fovmode="2">';
            panorama+='      <start projection="4" fov="100" pan="-5.53" tilt="-1.76"/>';
            panorama+='      <flyin projection="9" fov="170" pan="0" tilt="-90"/>';
            panorama+='      <min pan="0" tilt="-90" fovpixel="2"/>';
            panorama+='      <max scaletofit="1" fovstereographic="330" fov="140" pan="360" tilt="90" fovfisheye="360"/>';
            panorama+='    </view>';
            panorama+='    <userdata nodeid="node2" title="bedroom 2" tags="Pano2VR7"/>';
            panorama+='    <hotspots height="20" wordwrap="1" width="180" smoothmovement="0">';
            panorama+='      <label background="1" height="20" enabled="1" bordercolor="0x000000" wordwrap="1" borderradius="1" border="1" textalpha="1" backgroundalpha="1" width="180" backgroundcolor="0xffffff" borderalpha="1" textcolor="0x000000"/>';
            panorama+='      <polystyle bordercolor="0x0000ff" handcursor="1" mode="0" backgroundalpha="0.25098" backgroundcolor="0x0000ff" borderalpha="1"/>';
            panorama+='      <hotspot title="" pan="-4.54" id="Point01" tilt="5.6" skinid="ht_image" url="images/6a34e9128272b21e769f4b828895f172.jpg" target=""/>';
            panorama+='      <hotspot title="bedroom 1" pan="-22.14" id="Point02" tilt="1.51" skinid="ht_node" url="{node1}" target="-23.2/-1.7/149.4"/>';
            panorama+='      <hotspot title="sitting room" pan="-141.34" id="Point03" tilt="10.28" skinid="ht_node" url="{node6}" target=""/>';
            panorama+='    </hotspots>';
            panorama+='    <transition enabled="1" zoomout="3" zoomspeed="2" zoomin="2" delay="none" zoomafteroutfov="40" type="diptocolor" zoomafterinfov="140" zoomoutpause="1" blendcolor="0xaaff00" zoomfov="40" blendtime="1" softedge="0"/>';
            panorama+='  </panorama>';

            // Master Node & Finish
            panorama+='  <masternode>';
            panorama+='    <userdata copyright="" author="" title="" comment="" description="" tags=""/>';
            panorama+='    <animationsequences>';
            panorama+='      <sequence title="Animation01">';
            panorama+='        <sequenceelement nodeid="node7" cliptitle="Clip01" index="0" startview="35.72/-3.6/100/4"/>';
            panorama+='        <sequenceelement nodeid="node6" cliptitle="Clip01" index="1" startview="-3.86/-3.29/100/4"/>';
            panorama+='      </sequence>';
            panorama+='    </animationsequences>';
            panorama+='  </masternode>';
            panorama+='</tour>';

            // --- EXECUTE CONFIG ---
            pano.readConfigString(panorama);
            console.log("Pano2VR Config loaded.");
        }
    </script>
</body>
</html>